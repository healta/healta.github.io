<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conway's Game of Life | Dimitar Dimitrov</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/styles.css">

    <style>
        .conway-layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 1.5rem;
            padding: 1.5rem;
            min-height: 100vh;
            padding-top: 80px;
        }

        @media (max-width: 1024px) {
            .conway-layout {
                grid-template-columns: 1fr;
            }
        }

        .canvas-wrapper {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            overflow: hidden;
            position: relative;
        }

        #conway-canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        .canvas-overlay {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .canvas-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .canvas-info span {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }

        .panel-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title i {
            color: var(--accent-primary);
        }

        .panel-body {
            padding: 1.25rem;
        }

        .control-row {
            margin-bottom: 1rem;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            display: block;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0.25rem;
        }

        .rule-checkbox {
            width: 100%;
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .rule-checkbox:hover {
            border-color: var(--accent-primary);
        }

        .rule-checkbox.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-group .btn {
            flex: 1;
        }

        .speed-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .preset-select {
            width: 100%;
            padding: 0.625rem 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .preset-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .stat-item {
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 0.6875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        .playback-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .play-btn {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border: none;
            border-radius: var(--radius-full);
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .step-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-btn:hover {
            background: var(--bg-glass);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zoom-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .zoom-value {
            min-width: 50px;
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .hint-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container nav-container">
            <a href="../index.html" class="nav-brand">
                <i class="fa-solid fa-arrow-left" style="margin-right: 0.5rem;"></i> DD
            </a>
            <span style="color: var(--text-secondary);">Conway's Game of Life</span>
        </div>
    </nav>

    <div class="conway-layout">
        <!-- Canvas -->
        <div class="canvas-wrapper">
            <canvas id="conway-canvas"></canvas>
            <div class="canvas-overlay">
                <div class="canvas-info">Gen: <span id="gen-display">0</span></div>
                <div class="canvas-info">Zoom: <span id="zoom-display">100%</span></div>
                <div class="canvas-info">Cells: <span id="cells-display">0</span></div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Playback Panel -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-play"></i> Playback</span>
                </div>
                <div class="panel-body">
                    <div class="control-row">
                        <div class="playback-controls">
                            <button class="play-btn" id="play-btn" title="Play/Pause">
                                <i class="fa-solid fa-play" id="play-icon"></i>
                            </button>
                            <button class="step-btn" id="step-btn" title="Step Forward">
                                <i class="fa-solid fa-forward-step"></i>
                            </button>
                            <button class="step-btn" id="reset-btn" title="Randomize">
                                <i class="fa-solid fa-shuffle"></i>
                            </button>
                            <button class="step-btn" id="clear-btn" title="Clear">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Speed</label>
                        <input type="range" id="speed-slider" class="range-slider" min="1" max="60" value="15">
                        <div class="speed-display">
                            <span>Slow</span>
                            <span id="speed-value">15 FPS</span>
                            <span>Fast</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rules Panel -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-sliders"></i> Rules</span>
                </div>
                <div class="panel-body">
                    <div class="control-row">
                        <label class="control-label">Preset</label>
                        <select id="preset-select" class="preset-select">
                            <option value="B3/S23">Classic (B3/S23)</option>
                            <option value="B36/S23">HighLife (B36/S23)</option>
                            <option value="B3678/S34678">Day & Night (B3678/S34678)</option>
                            <option value="B1357/S1357">Replicator (B1357/S1357)</option>
                            <option value="B2/S">Seeds (B2/S)</option>
                            <option value="B25/S4">Maze (B25/S4)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Birth (B) - Dead cell becomes alive if neighbors =</label>
                        <div class="checkbox-grid" id="birth-rules">
                            <div class="rule-checkbox" data-value="0">0</div>
                            <div class="rule-checkbox" data-value="1">1</div>
                            <div class="rule-checkbox" data-value="2">2</div>
                            <div class="rule-checkbox active" data-value="3">3</div>
                            <div class="rule-checkbox" data-value="4">4</div>
                            <div class="rule-checkbox" data-value="5">5</div>
                            <div class="rule-checkbox" data-value="6">6</div>
                            <div class="rule-checkbox" data-value="7">7</div>
                            <div class="rule-checkbox" data-value="8">8</div>
                        </div>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Survival (S) - Live cell survives if neighbors =</label>
                        <div class="checkbox-grid" id="survival-rules">
                            <div class="rule-checkbox" data-value="0">0</div>
                            <div class="rule-checkbox" data-value="1">1</div>
                            <div class="rule-checkbox active" data-value="2">2</div>
                            <div class="rule-checkbox active" data-value="3">3</div>
                            <div class="rule-checkbox" data-value="4">4</div>
                            <div class="rule-checkbox" data-value="5">5</div>
                            <div class="rule-checkbox" data-value="6">6</div>
                            <div class="rule-checkbox" data-value="7">7</div>
                            <div class="rule-checkbox" data-value="8">8</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View Panel -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-expand"></i> View</span>
                </div>
                <div class="panel-body">
                    <div class="control-row">
                        <label class="control-label">Zoom</label>
                        <div class="zoom-controls">
                            <button class="zoom-btn" id="zoom-out"><i class="fa-solid fa-minus"></i></button>
                            <span class="zoom-value" id="zoom-value">100%</span>
                            <button class="zoom-btn" id="zoom-in"><i class="fa-solid fa-plus"></i></button>
                            <button class="zoom-btn" id="zoom-reset" title="Reset View"><i
                                    class="fa-solid fa-compress"></i></button>
                        </div>
                        <p class="hint-text">Scroll to zoom, drag to pan</p>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Grid Size</label>
                        <select id="grid-size" class="preset-select">
                            <option value="100">100 x 100</option>
                            <option value="150" selected>150 x 150</option>
                            <option value="200">200 x 200</option>
                            <option value="300">300 x 300</option>
                            <option value="500">500 x 500</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Stats Panel -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-chart-simple"></i> Statistics</span>
                </div>
                <div class="panel-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="stat-generation">0</div>
                            <div class="stat-label">Generation</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-population">0</div>
                            <div class="stat-label">Population</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-fps">0</div>
                            <div class="stat-label">FPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-density">0%</div>
                            <div class="stat-label">Density</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Conway's Game of Life - High Performance Implementation
        class GameOfLife {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');

                // Grid settings
                this.gridSize = 150;
                this.cellSize = 6;

                // State - using Uint8Array for performance
                this.grid = null;
                this.buffer = null;

                // Rules - Birth and Survival
                this.birthRules = new Set([3]);
                this.survivalRules = new Set([2, 3]);

                // View state
                this.zoom = 1;
                this.panX = 0;
                this.panY = 0;

                // Playback state
                this.isPlaying = false;
                this.speed = 15; // FPS
                this.generation = 0;

                // Interaction state
                this.isDragging = false;
                this.lastMouseX = 0;
                this.lastMouseY = 0;

                // Performance tracking
                this.lastFrameTime = 0;
                this.frameCount = 0;
                this.fps = 0;

                this.init();
                this.setupEventListeners();
            }

            init() {
                this.resizeCanvas();
                this.initGrid();
                this.randomize();
                this.render();
            }

            initGrid() {
                const size = this.gridSize * this.gridSize;
                this.grid = new Uint8Array(size);
                this.buffer = new Uint8Array(size);
            }

            resizeCanvas() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.centerView();
            }

            centerView() {
                const gridPixelSize = this.gridSize * this.cellSize;
                this.panX = (this.canvas.width - gridPixelSize * this.zoom) / 2;
                this.panY = (this.canvas.height - gridPixelSize * this.zoom) / 2;
            }

            randomize(density = 0.3) {
                for (let i = 0; i < this.grid.length; i++) {
                    this.grid[i] = Math.random() < density ? 1 : 0;
                }
                this.generation = 0;
                this.updateStats();
            }

            clear() {
                this.grid.fill(0);
                this.generation = 0;
                this.updateStats();
            }

            getIndex(x, y) {
                return y * this.gridSize + x;
            }

            getCell(x, y) {
                if (x < 0 || x >= this.gridSize || y < 0 || y >= this.gridSize) {
                    return 0;
                }
                return this.grid[this.getIndex(x, y)];
            }

            setCell(x, y, value) {
                if (x >= 0 && x < this.gridSize && y >= 0 && y < this.gridSize) {
                    this.grid[this.getIndex(x, y)] = value;
                }
            }

            toggleCell(x, y) {
                if (x >= 0 && x < this.gridSize && y >= 0 && y < this.gridSize) {
                    const idx = this.getIndex(x, y);
                    this.grid[idx] = this.grid[idx] ? 0 : 1;
                }
            }

            countNeighbors(x, y) {
                let count = 0;
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        if (dx === 0 && dy === 0) continue;
                        count += this.getCell(x + dx, y + dy);
                    }
                }
                return count;
            }

            step() {
                for (let y = 0; y < this.gridSize; y++) {
                    for (let x = 0; x < this.gridSize; x++) {
                        const idx = this.getIndex(x, y);
                        const alive = this.grid[idx];
                        const neighbors = this.countNeighbors(x, y);

                        if (alive) {
                            this.buffer[idx] = this.survivalRules.has(neighbors) ? 1 : 0;
                        } else {
                            this.buffer[idx] = this.birthRules.has(neighbors) ? 1 : 0;
                        }
                    }
                }

                // Swap buffers
                [this.grid, this.buffer] = [this.buffer, this.grid];
                this.generation++;
                this.updateStats();
            }

            render() {
                const ctx = this.ctx;
                const canvas = this.canvas;

                // Clear canvas
                ctx.fillStyle = '#0a0a0f';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Apply transformations
                ctx.save();
                ctx.translate(this.panX, this.panY);
                ctx.scale(this.zoom, this.zoom);

                // Draw grid background
                ctx.fillStyle = '#12121a';
                ctx.fillRect(0, 0, this.gridSize * this.cellSize, this.gridSize * this.cellSize);

                // Draw cells
                ctx.fillStyle = '#6366f1';
                for (let y = 0; y < this.gridSize; y++) {
                    for (let x = 0; x < this.gridSize; x++) {
                        if (this.grid[this.getIndex(x, y)]) {
                            ctx.fillRect(
                                x * this.cellSize + 0.5,
                                y * this.cellSize + 0.5,
                                this.cellSize - 1,
                                this.cellSize - 1
                            );
                        }
                    }
                }

                // Draw grid lines (only when zoomed in enough)
                if (this.zoom > 0.5) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.03)';
                    ctx.lineWidth = 0.5 / this.zoom;
                    ctx.beginPath();
                    for (let i = 0; i <= this.gridSize; i++) {
                        ctx.moveTo(i * this.cellSize, 0);
                        ctx.lineTo(i * this.cellSize, this.gridSize * this.cellSize);
                        ctx.moveTo(0, i * this.cellSize);
                        ctx.lineTo(this.gridSize * this.cellSize, i * this.cellSize);
                    }
                    ctx.stroke();
                }

                ctx.restore();
            }

            getPopulation() {
                let count = 0;
                for (let i = 0; i < this.grid.length; i++) {
                    count += this.grid[i];
                }
                return count;
            }

            updateStats() {
                const pop = this.getPopulation();
                const density = (pop / this.grid.length * 100).toFixed(1);

                document.getElementById('stat-generation').textContent = this.generation;
                document.getElementById('stat-population').textContent = pop;
                document.getElementById('stat-density').textContent = density + '%';
                document.getElementById('gen-display').textContent = this.generation;
                document.getElementById('cells-display').textContent = pop;
            }

            updateFPS() {
                const now = performance.now();
                this.frameCount++;

                if (now - this.lastFrameTime >= 1000) {
                    this.fps = this.frameCount;
                    this.frameCount = 0;
                    this.lastFrameTime = now;
                    document.getElementById('stat-fps').textContent = this.fps;
                }
            }

            start() {
                this.isPlaying = true;
                document.getElementById('play-icon').className = 'fa-solid fa-pause';
                this.loop();
            }

            stop() {
                this.isPlaying = false;
                document.getElementById('play-icon').className = 'fa-solid fa-play';
            }

            toggle() {
                if (this.isPlaying) {
                    this.stop();
                } else {
                    this.start();
                }
            }

            loop() {
                if (!this.isPlaying) return;

                this.step();
                this.render();
                this.updateFPS();

                setTimeout(() => {
                    requestAnimationFrame(() => this.loop());
                }, 1000 / this.speed);
            }

            setZoom(zoom, centerX, centerY) {
                const oldZoom = this.zoom;
                this.zoom = Math.max(0.1, Math.min(5, zoom));

                // Zoom towards center point
                if (centerX !== undefined && centerY !== undefined) {
                    this.panX = centerX - (centerX - this.panX) * (this.zoom / oldZoom);
                    this.panY = centerY - (centerY - this.panY) * (this.zoom / oldZoom);
                }

                this.updateZoomDisplay();
                this.render();
            }

            updateZoomDisplay() {
                const zoomPercent = Math.round(this.zoom * 100) + '%';
                document.getElementById('zoom-display').textContent = zoomPercent;
                document.getElementById('zoom-value').textContent = zoomPercent;
            }

            screenToGrid(screenX, screenY) {
                const x = Math.floor((screenX - this.panX) / (this.cellSize * this.zoom));
                const y = Math.floor((screenY - this.panY) / (this.cellSize * this.zoom));
                return { x, y };
            }

            setGridSize(size) {
                this.gridSize = size;
                this.initGrid();
                this.randomize();
                this.centerView();
                this.render();
            }

            setRules(birth, survival) {
                this.birthRules = new Set(birth);
                this.survivalRules = new Set(survival);
            }

            setupEventListeners() {
                // Mouse wheel zoom
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? 0.9 : 1.1;
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    this.setZoom(this.zoom * delta, x, y);
                });

                // Pan & draw
                this.canvas.addEventListener('mousedown', (e) => {
                    if (e.button === 0) {
                        if (e.shiftKey || !this.isPlaying) {
                            // Draw mode
                            const rect = this.canvas.getBoundingClientRect();
                            const { x, y } = this.screenToGrid(e.clientX - rect.left, e.clientY - rect.top);
                            this.toggleCell(x, y);
                            this.render();
                        } else {
                            // Pan mode
                            this.isDragging = true;
                            this.lastMouseX = e.clientX;
                            this.lastMouseY = e.clientY;
                        }
                    }
                });

                this.canvas.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        this.panX += e.clientX - this.lastMouseX;
                        this.panY += e.clientY - this.lastMouseY;
                        this.lastMouseX = e.clientX;
                        this.lastMouseY = e.clientY;
                        this.render();
                    }
                });

                this.canvas.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });

                this.canvas.addEventListener('mouseleave', () => {
                    this.isDragging = false;
                });

                // Window resize
                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                    this.render();
                });
            }
        }

        // Initialize
        const canvas = document.getElementById('conway-canvas');
        const game = new GameOfLife(canvas);

        // UI Controls
        document.getElementById('play-btn').addEventListener('click', () => game.toggle());
        document.getElementById('step-btn').addEventListener('click', () => {
            game.step();
            game.render();
        });
        document.getElementById('reset-btn').addEventListener('click', () => {
            game.randomize();
            game.render();
        });
        document.getElementById('clear-btn').addEventListener('click', () => {
            game.clear();
            game.render();
        });

        // Speed slider
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        speedSlider.addEventListener('input', () => {
            game.speed = parseInt(speedSlider.value);
            speedValue.textContent = game.speed + ' FPS';
        });

        // Zoom controls
        document.getElementById('zoom-in').addEventListener('click', () => {
            game.setZoom(game.zoom * 1.2, canvas.width / 2, canvas.height / 2);
        });
        document.getElementById('zoom-out').addEventListener('click', () => {
            game.setZoom(game.zoom * 0.8, canvas.width / 2, canvas.height / 2);
        });
        document.getElementById('zoom-reset').addEventListener('click', () => {
            game.zoom = 1;
            game.centerView();
            game.updateZoomDisplay();
            game.render();
        });

        // Grid size
        document.getElementById('grid-size').addEventListener('change', (e) => {
            game.setGridSize(parseInt(e.target.value));
        });

        // Rule checkboxes
        function updateRuleUI() {
            document.querySelectorAll('#birth-rules .rule-checkbox').forEach(el => {
                const value = parseInt(el.dataset.value);
                el.classList.toggle('active', game.birthRules.has(value));
            });
            document.querySelectorAll('#survival-rules .rule-checkbox').forEach(el => {
                const value = parseInt(el.dataset.value);
                el.classList.toggle('active', game.survivalRules.has(value));
            });
        }

        document.querySelectorAll('#birth-rules .rule-checkbox').forEach(el => {
            el.addEventListener('click', () => {
                const value = parseInt(el.dataset.value);
                if (game.birthRules.has(value)) {
                    game.birthRules.delete(value);
                } else {
                    game.birthRules.add(value);
                }
                el.classList.toggle('active');
                document.getElementById('preset-select').value = 'custom';
            });
        });

        document.querySelectorAll('#survival-rules .rule-checkbox').forEach(el => {
            el.addEventListener('click', () => {
                const value = parseInt(el.dataset.value);
                if (game.survivalRules.has(value)) {
                    game.survivalRules.delete(value);
                } else {
                    game.survivalRules.add(value);
                }
                el.classList.toggle('active');
                document.getElementById('preset-select').value = 'custom';
            });
        });

        // Presets
        const presets = {
            'B3/S23': { birth: [3], survival: [2, 3] },
            'B36/S23': { birth: [3, 6], survival: [2, 3] },
            'B3678/S34678': { birth: [3, 6, 7, 8], survival: [3, 4, 6, 7, 8] },
            'B1357/S1357': { birth: [1, 3, 5, 7], survival: [1, 3, 5, 7] },
            'B2/S': { birth: [2], survival: [] },
            'B25/S4': { birth: [2, 5], survival: [4] }
        };

        document.getElementById('preset-select').addEventListener('change', (e) => {
            const preset = presets[e.target.value];
            if (preset) {
                game.setRules(preset.birth, preset.survival);
                updateRuleUI();
            }
        });

        // Initial stats update
        game.updateStats();
    </script>
</body>

</html>