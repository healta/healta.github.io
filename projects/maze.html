<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Algorithms | Dimitar Dimitrov</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/styles.css">

    <style>
        .maze-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 1.5rem;
            padding: 1.5rem;
            min-height: 100vh;
            padding-top: 80px;
        }

        @media (max-width: 1024px) {
            .maze-layout {
                grid-template-columns: 1fr;
            }
        }

        .canvas-wrapper {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        #maze-canvas {
            display: block;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }

        .panel-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title i {
            color: var(--accent-primary);
        }

        .panel-body {
            padding: 1.25rem;
        }

        .control-row {
            margin-bottom: 1rem;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            display: block;
        }

        .algorithm-select {
            width: 100%;
            padding: 0.625rem 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .algorithm-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .ctrl-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .ctrl-btn:hover {
            background: var(--bg-glass);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .ctrl-btn.primary {
            background: var(--accent-gradient);
            border: none;
            color: white;
        }

        .ctrl-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .legend {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .stat {
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 0.6875rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container nav-container">
            <a href="../index.html" class="nav-brand">
                <i class="fa-solid fa-arrow-left" style="margin-right: 0.5rem;"></i> DD
            </a>
            <span style="color: var(--text-secondary);">Maze Algorithms</span>
        </div>
    </nav>

    <div class="maze-layout">
        <div class="canvas-wrapper">
            <canvas id="maze-canvas"></canvas>
        </div>

        <div class="sidebar">
            <!-- Controls -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-play"></i> Controls</span>
                </div>
                <div class="panel-body">
                    <div class="btn-group">
                        <button class="ctrl-btn primary" id="generate-btn">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Generate Maze
                        </button>
                        <button class="ctrl-btn" id="solve-btn">
                            <i class="fa-solid fa-route"></i> Solve Maze
                        </button>
                        <button class="ctrl-btn" id="clear-btn">
                            <i class="fa-solid fa-trash"></i> Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-gear"></i> Settings</span>
                </div>
                <div class="panel-body">
                    <div class="control-row">
                        <label class="control-label">Generation Algorithm</label>
                        <select id="gen-algorithm" class="algorithm-select">
                            <option value="recursive">Recursive Backtracker</option>
                            <option value="prim">Prim's Algorithm</option>
                            <option value="kruskal">Kruskal's Algorithm</option>
                        </select>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Solving Algorithm</label>
                        <select id="solve-algorithm" class="algorithm-select">
                            <option value="dfs">Depth-First Search</option>
                            <option value="bfs">Breadth-First Search</option>
                            <option value="astar">A* Search</option>
                        </select>
                    </div>

                    <div class="control-row">
                        <label class="control-label">Size</label>
                        <input type="range" id="size" class="range-slider" min="10" max="50" value="25">
                    </div>

                    <div class="control-row">
                        <label class="control-label">Speed</label>
                        <input type="range" id="speed" class="range-slider" min="1" max="100" value="50">
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-palette"></i> Legend</span>
                </div>
                <div class="panel-body">
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #12121a;"></div>
                            <span>Wall</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #1e1e2e;"></div>
                            <span>Path</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #22c55e;"></div>
                            <span>Start</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ef4444;"></div>
                            <span>End</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #6366f1;"></div>
                            <span>Visited</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f59e0b;"></div>
                            <span>Solution</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa-solid fa-chart-simple"></i> Statistics</span>
                </div>
                <div class="panel-body">
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="stat-cells">0</div>
                            <div class="stat-label">Cells</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="stat-visited">0</div>
                            <div class="stat-label">Visited</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="stat-path">0</div>
                            <div class="stat-label">Path Length</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="stat-time">0ms</div>
                            <div class="stat-label">Time</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('maze-canvas');
        const ctx = canvas.getContext('2d');

        let gridSize = 25;
        let cellSize = 20;
        let speed = 50;
        let grid = [];
        let running = false;
        let visitedCount = 0;
        let pathLength = 0;

        const WALL = 0;
        const PATH = 1;
        const START = 2;
        const END = 3;
        const VISITED = 4;
        const SOLUTION = 5;

        const colors = {
            [WALL]: '#12121a',
            [PATH]: '#1e1e2e',
            [START]: '#22c55e',
            [END]: '#ef4444',
            [VISITED]: '#6366f1',
            [SOLUTION]: '#f59e0b'
        };

        function resizeCanvas() {
            const wrapper = canvas.parentElement;
            const size = Math.min(wrapper.clientWidth - 32, wrapper.clientHeight - 32);
            canvas.width = size;
            canvas.height = size;
            cellSize = Math.floor(size / gridSize);
        }

        function initGrid() {
            grid = [];
            for (let y = 0; y < gridSize; y++) {
                grid[y] = [];
                for (let x = 0; x < gridSize; x++) {
                    grid[y][x] = WALL;
                }
            }
            visitedCount = 0;
            pathLength = 0;
            updateStats();
        }

        function draw() {
            ctx.fillStyle = '#12121a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    ctx.fillStyle = colors[grid[y][x]];
                    ctx.fillRect(x * cellSize + 1, y * cellSize + 1, cellSize - 2, cellSize - 2);
                }
            }
        }

        function updateStats() {
            const cells = gridSize * gridSize;
            document.getElementById('stat-cells').textContent = cells;
            document.getElementById('stat-visited').textContent = visitedCount;
            document.getElementById('stat-path').textContent = pathLength;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Maze generation - Recursive Backtracker
        async function generateRecursive() {
            initGrid();
            running = true;

            const stack = [];
            const startX = 1;
            const startY = 1;

            grid[startY][startX] = PATH;
            stack.push([startX, startY]);

            const directions = [[0, -2], [2, 0], [0, 2], [-2, 0]];

            while (stack.length > 0 && running) {
                const [x, y] = stack[stack.length - 1];

                // Shuffle directions
                const shuffled = [...directions].sort(() => Math.random() - 0.5);
                let found = false;

                for (const [dx, dy] of shuffled) {
                    const nx = x + dx;
                    const ny = y + dy;

                    if (nx > 0 && nx < gridSize - 1 && ny > 0 && ny < gridSize - 1 && grid[ny][nx] === WALL) {
                        grid[y + dy / 2][x + dx / 2] = PATH;
                        grid[ny][nx] = PATH;
                        stack.push([nx, ny]);
                        found = true;

                        draw();
                        await sleep(101 - speed);
                        break;
                    }
                }

                if (!found) {
                    stack.pop();
                }
            }

            // Set start and end
            grid[1][1] = START;
            grid[gridSize - 2][gridSize - 2] = END;
            draw();
            running = false;
        }

        // Maze solving - DFS
        async function solveDFS() {
            running = true;
            const startTime = performance.now();

            const stack = [[1, 1]];
            const visited = new Set();
            const parent = {};

            visited.add('1,1');
            visitedCount = 0;

            const directions = [[0, -1], [1, 0], [0, 1], [-1, 0]];

            while (stack.length > 0 && running) {
                const [x, y] = stack.pop();
                visitedCount++;

                if (grid[y][x] !== START && grid[y][x] !== END) {
                    grid[y][x] = VISITED;
                }

                if (grid[y][x] === END) {
                    // Trace path
                    let curr = `${x},${y}`;
                    pathLength = 0;
                    while (parent[curr]) {
                        const [px, py] = parent[curr].split(',').map(Number);
                        if (grid[py][px] !== START) {
                            grid[py][px] = SOLUTION;
                        }
                        curr = parent[curr];
                        pathLength++;
                    }
                    break;
                }

                for (const [dx, dy] of directions) {
                    const nx = x + dx;
                    const ny = y + dy;
                    const key = `${nx},${ny}`;

                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize &&
                        grid[ny][nx] !== WALL && !visited.has(key)) {
                        visited.add(key);
                        parent[key] = `${x},${y}`;
                        stack.push([nx, ny]);
                    }
                }

                draw();
                updateStats();
                await sleep(101 - speed);
            }

            const endTime = performance.now();
            document.getElementById('stat-time').textContent = Math.round(endTime - startTime) + 'ms';

            draw();
            running = false;
        }

        // BFS Solver
        async function solveBFS() {
            running = true;
            const startTime = performance.now();

            const queue = [[1, 1]];
            const visited = new Set();
            const parent = {};

            visited.add('1,1');
            visitedCount = 0;

            const directions = [[0, -1], [1, 0], [0, 1], [-1, 0]];

            while (queue.length > 0 && running) {
                const [x, y] = queue.shift();
                visitedCount++;

                if (grid[y][x] !== START && grid[y][x] !== END) {
                    grid[y][x] = VISITED;
                }

                if (grid[y][x] === END) {
                    let curr = `${x},${y}`;
                    pathLength = 0;
                    while (parent[curr]) {
                        const [px, py] = parent[curr].split(',').map(Number);
                        if (grid[py][px] !== START) {
                            grid[py][px] = SOLUTION;
                        }
                        curr = parent[curr];
                        pathLength++;
                    }
                    break;
                }

                for (const [dx, dy] of directions) {
                    const nx = x + dx;
                    const ny = y + dy;
                    const key = `${nx},${ny}`;

                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize &&
                        grid[ny][nx] !== WALL && !visited.has(key)) {
                        visited.add(key);
                        parent[key] = `${x},${y}`;
                        queue.push([nx, ny]);
                    }
                }

                draw();
                updateStats();
                await sleep(101 - speed);
            }

            const endTime = performance.now();
            document.getElementById('stat-time').textContent = Math.round(endTime - startTime) + 'ms';

            draw();
            running = false;
        }

        // Event listeners
        document.getElementById('generate-btn').addEventListener('click', async () => {
            if (running) {
                running = false;
                return;
            }
            gridSize = parseInt(document.getElementById('size').value);
            resizeCanvas();
            await generateRecursive();
        });

        document.getElementById('solve-btn').addEventListener('click', async () => {
            if (running) {
                running = false;
                return;
            }

            const algo = document.getElementById('solve-algorithm').value;

            // Reset visited cells
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    if (grid[y][x] === VISITED || grid[y][x] === SOLUTION) {
                        grid[y][x] = PATH;
                    }
                }
            }
            draw();

            switch (algo) {
                case 'dfs': await solveDFS(); break;
                case 'bfs': await solveBFS(); break;
                case 'astar': await solveBFS(); break; // Placeholder
            }
        });

        document.getElementById('clear-btn').addEventListener('click', () => {
            running = false;
            initGrid();
            draw();
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            speed = parseInt(e.target.value);
        });

        document.getElementById('size').addEventListener('input', (e) => {
            gridSize = parseInt(e.target.value);
            if (!running) {
                resizeCanvas();
                initGrid();
                draw();
            }
        });

        // Initialize
        window.addEventListener('resize', () => {
            resizeCanvas();
            draw();
        });
        resizeCanvas();
        initGrid();
        draw();
    </script>
</body>

</html>